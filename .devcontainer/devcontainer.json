{
	"name": "${localWorkspaceFolderBasename} Dev",
	
	// Use official Node 22 image with Debian Bookworm
	"image": "mcr.microsoft.com/devcontainers/javascript-node:22-bookworm",
	
	// Mount configuration - workspace and NAS
	"mounts": [
		// Mount current directory as workspace
		"source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached",
		// Mount NAS - Mac path (change for Linux: /mnt/nas/dev-root)
		"source=${localEnv:NAS_DEV_ROOT},target=/nas,type=bind,consistency=cached"
	],
	
	// Workspace folder
	"workspaceFolder": "/workspace",
	
	// Container environment variables
	"containerEnv": {
		// Mac NAS path
		"NAS_DEV_ROOT": "/nas",
		"DEBIAN_FRONTEND": "noninteractive",
		// Add NAS to CDPATH for easy navigation
		"CDPATH": ".:/nas:/workspace"
	},
	
	// Features for installing additional tools
	"features": {
		// GitHub CLI
		"ghcr.io/devcontainers/features/github-cli:1": {},
		// Common utilities (includes sudo, rsync, jq, curl, etc.)
		"ghcr.io/devcontainers/features/common-utils:2": {
			"installZsh": false,
			"configureZshAsDefaultShell": false,
			"username": "node",
			"userUid": "1000",
			"userGid": "1000",
			"upgradePackages": true
		}
	},
	
	// Run after container is created - setup tools and link NAS
	"postCreateCommand": "sudo npm install -g npm@latest --force && sudo npm install -g pnpm@latest && sudo npm install -g @anthropic-ai/claude-code && mkdir -p ~/.local/share/pnpm && pnpm config set store-dir ~/.local/share/pnpm --global && pnpm config set allow-scripts true --global && curl -LsSf https://astral.sh/uv/install.sh | sh && echo 'alias nas=\"cd /nas\"' >> ~/.bashrc && if [ -d '/nas' ]; then cd ~ && for item in /nas/* /nas/.*; do name=$(basename \"$item\"); [ \"$name\" != '.' ] && [ \"$name\" != '..' ] && [ \"$name\" != '.local' ] && [ \"$name\" != '.npm' ] && [ \"$name\" != '.cache' ] && [ \"$name\" != '.cursor-server' ] && ln -sf \"$item\" . 2>/dev/null; done; fi",
	
	// Port forwarding
	"forwardPorts": [5173, 5174, 5175, 5176, 5177, 5178],

	// Connect as node user
	"remoteUser": "node",
	
	// Customizations for VS Code/Cursor
	"customizations": {
		"vscode": {
			"settings": {
				"terminal.integrated.defaultProfile.linux": "bash",
				"terminal.integrated.profiles.linux": {
					"bash": {
						"path": "/bin/bash",
						"args": ["--login"]
					}
				}
			},
			"extensions": [
				"svelte.svelte-vscode",
				"dbaeumer.vscode-eslint",
				"esbenp.prettier-vscode"
			]
		}
	}
}